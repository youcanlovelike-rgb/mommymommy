name: Build Mommy Real Core
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: recursive

      - name: ğŸ’‰ ä¿®æ”¹è¡€ç»Ÿ (æ›¿æ¢ä¸ºä½ çš„åŒ…å)
        run: |
          grep -rl "org.drinkless.tdlib" . | xargs sed -i 's/org.drinkless.tdlib/org.mommy.messenger/g'
          grep -rl "org_drinkless_tdlib" . | xargs sed -i 's/org_drinkless_tdlib/org_mommy_messenger/g'

      - name: ğŸ› ï¸ å®‰è£… NDK å’Œå·¥å…·é“¾
        run: |
          sudo apt-get update
          sudo apt-get install -y cmake gperf php-cli
          # è‡ªåŠ¨ä¸‹è½½é…ç½® NDK ä¼šç”± GitHub é»˜è®¤ç¯å¢ƒå¤„ç†

      - name: ğŸ—ï¸ çœŸæ­£çš„å…¨åŠŸèƒ½ç¼–è¯‘
        run: |
          mkdir build && cd build
          cmake -DCMAKE_BUILD_TYPE=Release \
                -DANDROID_ABI=arm64-v8a \
                -DANDROID_PLATFORM=android-24 \
                -DTD_ENABLE_JNI=ON ..
          cmake --build . --target install -- -j$(nproc)

      - name: ğŸ“¦ ä¸Šä¼ æˆå“ libtdjni.so
        uses: actions/upload-artifact@v3
        with:
          name: mommy-real-so
          path: td_install/lib/libtdjni.so

